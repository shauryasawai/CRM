{% extends 'base/base.html' %}
{% load humanize %}
{% block title %}Dashboard{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
    :root {
        --primary-color: #1C64FF;
        --secondary-text: #696969;
        --background-color: #FFFFFF;
        --border-color: #D9D9D9;
        --highlight-color: #C3E4FF;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background-color: #f8f9fa;
        color: #333;
        line-height: 1.6;
    }
    
    /* Header Section */
    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .welcome-content {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .welcome-text {
        font-size: 2.0rem;
        font-weight: 400;
        color: #333;
        margin: 0;
    }

    .user-name {
        color: var(--primary-color);
        font-weight: 600;
    }

    .user-name-display {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--secondary-text);
        margin: 0;
    }

    .header-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.5rem;
    }

    .command-badge {
        background: var(--highlight-color);
        border-radius: 20px;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        border: none;
        box-shadow: 0 2px 8px rgba(28, 100, 255, 0.1);
    }

    .command-badge-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .command-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #333;
        margin: 0;
        line-height: 1.2;
    }

    .command-subtitle {
        font-size: 0.9rem;
        color: var(--secondary-text);
        margin: 0;
        line-height: 1.2;
    }

    .user-icon {
        width: 40px;
        height: 40px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .datetime-info {
        text-align: left;
        color: #333;
    }

    .date-text {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        line-height: 1.2;
    }

    .time-text {
        font-size: 1rem;
        color: var(--primary-color);
        margin: 0;
        line-height: 1.2;
    }
    /* Total AUM Section */
    .aum-section {
        background: linear-gradient(135deg, var(--primary-color) 0%, #0d47a1 100%);
        border-radius: 20px;
        padding: 3rem 2rem;
        margin-bottom: 3rem;
        color: white;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(28, 100, 255, 0.2);
    }

    .aum-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .aum-content {
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .aum-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 1.5rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .aum-title {
        font-size: 2.0rem;
        font-weight: 600;
        margin-bottom: 1rem;
        opacity: 0.9;
    }

    .aum-value {
        font-size: 4rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-variant-numeric: tabular-nums;
    }

    .aum-description {
        font-size: 1.1rem;
        opacity: 0.8;
        margin-bottom: 2rem;
    }

    .aum-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .aum-btn {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.875rem 2rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .aum-btn:hover {
        background: white;
        color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }



    .top-navigation {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .notification-bell {
        position: relative;
        width: 45px;
        height: 45px;
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .notification-bell:hover {
        background: var(--highlight-color);
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }

    .notification-bell i {
        font-size: 1.2rem;
        color: #333;
    }

    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ff4757;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
        border: 2px solid white;
    }

    .command-center-badge {
        background: var(--highlight-color);
        border: 1px solid rgba(28, 100, 255, 0.2);
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .command-center-text {
        text-align: center;
    }

    .command-center-title {
        font-size: 1rem;
        font-weight: 700;
        color: #333;
        margin: 0;
        line-height: 1.2;
    }

    .command-center-subtitle {
        font-size: 0.8rem;
        color: var(--secondary-text);
        margin: 0;
        line-height: 1.2;
    }

    .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .user-avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }

    .dashboard-header {
        background: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--border-color);
    }

    .welcome-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    
    .user-name {
        font-weight: 700;
        color: var(--primary-color);
    }

    .datetime-display {
        text-align: right;
        color: var(--secondary-text);
    }

    .date-text {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333;
        margin: 0;
    }

    .time-text {
        font-size: 1rem;
        color: var(--primary-color);
        font-weight: 500;
        margin: 0;
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 1rem;
        text-align: center;
    }

    .role-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--highlight-color);
        border: 1px solid var(--primary-color);
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--primary-color);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 1.5rem;
    }

    .header-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: var(--primary-color);
        border: 1px solid var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: #0d47a1;
        border-color: #0d47a1;
        color: white;
        transform: translateY(-2px);
    }

    .btn-hrms {
        background: white;
        color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .btn-hrms:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    .section-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-icon {
        width: 45px;
        height: 45px;
        background: var(--primary-color);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
    }

    .kpi-card, .metric-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    .kpi-card::before, .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-color);
        border-radius: 15px 15px 0 0;
    }

    .kpi-card.success::before {
        background: var(--success-color);
    }

    .kpi-card.warning::before {
        background: var(--warning-color);
    }

    .kpi-card.danger::before {
        background: var(--danger-color);
    }

    .kpi-card:hover, .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        border-color: var(--primary-color);
    }

    .kpi-header, .metric-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
    }

    .kpi-icon, .metric-icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: var(--highlight-color);
        color: var(--primary-color);
    }

    .kpi-card.success .kpi-icon {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
    }

    .kpi-card.warning .kpi-icon {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning-color);
    }

    .kpi-card.danger .kpi-icon {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger-color);
    }

    .kpi-trend, .metric-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem 1rem;
        background: var(--highlight-color);
        color: var(--primary-color);
        border-radius: 20px;
        font-size: 0.6rem;
        font-weight: 600;
    }

    .kpi-label {
        font-size: 0.9rem;
        color: var(--secondary-text);
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .kpi-value, .metric-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #333;
        line-height: 1;
        margin-bottom: 1rem;
        font-variant-numeric: tabular-nums;
    }

    .kpi-description {
        font-size: 0.95rem;
        color: var(--secondary-text);
        line-height: 1.4;
    }

    .metric-label {
        font-size: 1rem;
        color: var(--secondary-text);
        font-weight: 500;
    }

    .stat-item {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-left: 4px solid var(--primary-color);
    }

    .stat-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary-color);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        background: var(--highlight-color);
        color: var(--primary-color);
        flex-shrink: 0;
    }

    .stat-value {
        font-size: 1.75rem;
        font-weight: 800;
        color: #333;
        margin-bottom: 0.25rem;
        font-variant-numeric: tabular-nums;
    }

    .stat-label {
        font-size: 0.9rem;
        color: var(--secondary-text);
        font-weight: 500;
    }

    .quick-action {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        text-decoration: none;
        color: #333;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        display: block;
    }

    .quick-action:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-color);
        color: #333;
    }

    .quick-action-icon {
        font-size: 2rem;
        margin-bottom: 0.75rem;
        color: var(--primary-color);
    }

    .quick-action-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .quick-action-desc {
        font-size: 0.85rem;
        color: var(--secondary-text);
    }

    .activity-list {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .activity-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid #f8f9fa;
        transition: all 0.3s ease;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-item:hover {
        background: #f8f9fa;
        margin: 0 -1rem;
        padding: 1rem;
        border-radius: 8px;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        background: var(--highlight-color);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: var(--primary-color);
        flex-shrink: 0;
    }

    .activity-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.25rem;
    }

    .activity-meta {
        font-size: 0.85rem;
        color: var(--secondary-text);
    }

    .chart-section {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        margin-top: 2rem;
    }

    .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .chart-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
    }

    .chart-placeholder {
        height: 300px;
        background: linear-gradient(135deg, var(--highlight-color), #f8f9fa);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--border-color);
        color: var(--secondary-text);
        flex-direction: column;
        gap: 1rem;
        transition: all 0.3s ease;
    }

    .chart-placeholder:hover {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, var(--highlight-color), rgba(28, 100, 255, 0.05));
    }

    .placeholder-icon {
        font-size: 3rem;
        color: var(--primary-color);
        opacity: 0.7;
    }

    .placeholder-text {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333;
    }

    .placeholder-subtext {
        font-size: 0.9rem;
        color: var(--secondary-text);
        text-align: center;
        max-width: 400px;
    }

    .fade-in {
        animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .stagger-animation {
        animation: staggerIn 0.6s ease-out both;
    }

    @keyframes staggerIn {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .top-navigation {
            justify-content: center;
            margin-bottom: 1rem;
        }

        .welcome-section {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        .aum-section {
            padding: 2rem 1.5rem;
        }
        
        .datetime-display {
            text-align: left;
        }
        
        .dashboard-title {
            font-size: 2rem;
        }
        
        .kpi-value, .metric-value {
            font-size: 2rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
        }
        
        .header-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .action-btn {
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }
        
        .chart-placeholder {
            height: 250px;
        }

        .command-center-badge {
            padding: 0.5rem 1rem;
        }

        .command-center-title {
            font-size: 0.9rem;
        }

        .command-center-subtitle {
            font-size: 0.75rem;
        }
    }

    @media (max-width: 576px) {
        .section-title {
            font-size: 1.5rem;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .kpi-card, .metric-card {
            padding: 1.5rem;
        }
        
        .stat-item {
            flex-direction: column;
            text-align: center;
            gap: 0.75rem;
        }

        .top-navigation {
            flex-direction: column;
            gap: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
<!-- Header Section -->
    <div class="header-section">
        <div class="welcome-content">
            <h1 class="welcome-text">Welcome back, <span class="user-name">{{ request.user.get_full_name }}</span></h1>
            <!-- <p class="welcome-text user-name">{{ request.user.get_full_name }}</p> -->
        </div>
        
         
        <div class="header-info">
            <div class="command-badge">
                <div class="command-badge-content">
                    <div class="command-title">Command Center</div>
                    <div class="command-subtitle">
                        {% if request.user.role == 'top_management' %}
                            Executive Leadership
                        {% elif request.user.role == 'business_head' %}
                            Business Head
                        {% elif request.user.role == 'rm_head' %}
                            Regional Manager Head
                        {% else %}
                            Relationship Manager
                        {% endif %}
                    </div>
                </div>
                <div class="user-icon">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            
        </div>
           <!-- <div class="datetime-info">
                <div class="date-text" id="current-date"></div>
                <div class="time-text" id="current-time"></div>
            </div> -->
        
    </div>
    <!-- Total AUM Section -->
    <div class="aum-section">
        <div class="aum-content">
            <h2 class="aum-title">Trust. Connect. Grow.</h2>
            <div class="aum-actions">
                <a href="{% url 'hrm_dashboard' %}" class="aum-btn">
                    <i class="fas fa-clipboard-list"></i>
                    <span>HRMS Portal</span>
                </a>
                <!-- <a href="{% url 'lead_create' %}" class="aum-btn">
                    <i class="fas fa-plus"></i>
                    <span>Add New Lead</span>
                </a> -->
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Content -->
        {% if request.user.role == 'top_management' or request.user.role == 'business_head' or request.user.role == 'business_head_ops' %}
            <!-- Top Management/Business Head KPIs -->
            <h2 class="section-title">
                <div class="section-icon"><i class="fas fa-chart-line"></i></div>
                Executive KPI Dashboard
            </h2>
            
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="kpi-card fade-in">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-dollar-sign"></i></div>
                            <div class="kpi-trend">
                                <i class="fas fa-chart-line"></i> Total
                            </div>
                        </div>
                        <div class="kpi-label">Total AUM</div>
                        <div class="kpi-value">₹{{ total_aum|intcomma|default:"0" }}</div>
                        <div class="kpi-description">Assets Under Management across all portfolios</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="kpi-card success fade-in">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-sync-alt"></i></div>
                            <div class="kpi-trend">
                                <i class="fas fa-bolt"></i> Active
                            </div>
                        </div>
                        <div class="kpi-label">Total SIPs</div>
                        <div class="kpi-value">₹{{ total_sip|intcomma|default:"0" }}</div>
                        <div class="kpi-description">Systematic Investment Plans currently active</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="kpi-card warning fade-in">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-users"></i></div>
                            <div class="kpi-trend">
                                <i class="fas fa-rocket"></i> {{ total_users|default:"0" }}
                            </div>
                        </div>
                        <div class="kpi-label">Total Users</div>
                        <div class="kpi-value">{{ total_users|default:"0" }}</div>
                        <div class="kpi-description">Active users across all roles and teams</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="kpi-card danger fade-in">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-tasks"></i></div>
                            <div class="kpi-trend">
                                <i class="fas fa-exclamation-triangle"></i> {{ pending_tasks|default:"0" }}
                            </div>
                        </div>
                        <div class="kpi-label">Pending Tasks</div>
                        <div class="kpi-value">{{ pending_tasks|default:"0" }}</div>
                        <div class="kpi-description">Tasks requiring immediate attention</div>
                    </div>
                </div>
            </div>

            <!-- Business Metrics -->
            <h2 class="section-title">
                <div class="section-icon"><i class="fas fa-chart-bar"></i></div>
                Business Metrics
            </h2>
            
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.1s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-bullseye"></i></div>
                            <div class="metric-badge">{{ total_leads|default:"0" }} Total</div>
                        </div>
                        <div class="metric-value">{{ total_leads|default:"0" }}</div>
                        <div class="metric-label">Total Leads</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.2s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-user-tie"></i></div>
                            <div class="metric-badge">{{ total_clients|default:"0" }} Active</div>
                        </div>
                        <div class="metric-value">{{ total_clients|default:"0" }}</div>
                        <div class="metric-label">Total Clients</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.3s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-sitemap"></i></div>
                            <div class="metric-badge">{{ total_teams|default:"0" }} Teams</div>
                        </div>
                        <div class="metric-value">{{ total_teams|default:"0" }}</div>
                        <div class="metric-label">Active Teams</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.4s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-tools"></i></div>
                            <div class="metric-badge">{{ service_requests_count|default:"0" }} Open</div>
                        </div>
                        <div class="metric-value">{{ service_requests_count|default:"0" }}</div>
                        <div class="metric-label">Service Requests</div>
                    </div>
                </div>
            </div>

        {% elif request.user.role == 'rm_head' %}
            <!-- RM Head Dashboard -->
            <h2 class="section-title">
                <div class="section-icon"><i class="fas fa-bolt"></i></div>
                Team Leadership Overview
            </h2>
            
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.1s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-users"></i></div>
                            <div class="metric-badge">{{ team_members|length|default:"0" }} Members</div>
                        </div>
                        <div class="metric-value">{{ team_members|length|default:"0" }}</div>
                        <div class="metric-label">Team Members</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.2s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-dollar-sign"></i></div>
                            <div class="metric-badge">₹{{ team_aum|intcomma|default:"0" }}</div>
                        </div>
                        <div class="metric-value">₹{{ team_aum|intcomma|default:"0" }}</div>
                        <div class="metric-label">Team AUM</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.3s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-bullseye"></i></div>
                            <div class="metric-badge">{{ leads_count|default:"0" }} Active</div>
                        </div>
                        <div class="metric-value">{{ leads_count|default:"0" }}</div>
                        <div class="metric-label">Team Leads</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.4s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-tasks"></i></div>
                            <div class="metric-badge">{{ pending_tasks|default:"0" }} Pending</div>
                        </div>
                        <div class="metric-value">{{ pending_tasks|default:"0" }}</div>
                        <div class="metric-label">Team Tasks</div>
                    </div>
                </div>
            </div>

        {% else %}
            <!-- Regular RM Dashboard -->
            <h2 class="section-title">
                <div class="section-icon"><i class="fas fa-handshake"></i></div>
                Personal Dashboard
            </h2>
            
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.1s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-bullseye"></i></div>
                            <div class="metric-badge">{{ leads_count|default:"0" }} Total</div>
                        </div>
                        <div class="metric-value">{{ leads_count|default:"0" }}</div>
                        <div class="metric-label">My Leads</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.2s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-user-tie"></i></div>
                            <div class="metric-badge">{{ clients_count|default:"0" }} Active</div>
                        </div>
                        <div class="metric-value">{{ clients_count|default:"0" }}</div>
                        <div class="metric-label">My Clients</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.3s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="metric-badge">{{ overdue_tasks|default:"0" }} Tasks</div>
                        </div>
                        <div class="metric-value">{{ overdue_tasks|default:"0" }}</div>
                        <div class="metric-label">Overdue Tasks</div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="metric-card stagger-animation" style="animation-delay: 0.4s">
                        <div class="metric-header">
                            <div class="metric-icon"><i class="fas fa-tasks"></i></div>
                            <div class="metric-badge">{{ pending_tasks|default:"0" }} Pending</div>
                        </div>
                        <div class="metric-value">{{ pending_tasks|default:"0" }}</div>
                        <div class="metric-label">My Tasks</div>
                    </div>
                </div>
            </div>

            <!-- Personal SIP Information -->
            <div class="row mb-4">
                <div class="col-lg-4 col-md-6 mb-3">
                    <div class="stat-item stagger-animation" style="animation-delay: 0.5s">
                        <div class="stat-icon"><i class="fas fa-sync-alt"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">₹{{ my_sip|intcomma|default:"0" }}</div>
                            <div class="stat-label">Monthly SIP Amount</div>
                        </div>
                    </div>
                </div>

                <!-- <div class="col-lg-4 col-md-6 mb-3">
                    <div class="stat-item stagger-animation" style="animation-delay: 0.6s">
                        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">{{ overdue_tasks|default:"0" }}</div>
                            <div class="stat-label">Overdue Tasks</div>
                        </div>
                    </div>
                </div> -->
                 <div class="col-lg-4 col-md-6 mb-3">
                    <div class="stat-item stagger-animation" style="animation-delay: 0.6s">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">₹{{ my_aum|intcomma|default:"0" }}</div>
                            <div class="stat-label">My AUM</div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-md-6 mb-3">
                    <div class="stat-item stagger-animation" style="animation-delay: 0.7s">
                        <div class="stat-icon"><i class="fas fa-tools"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">{{ service_requests.count|default:"0" }}</div>
                            <div class="stat-label">Service Requests</div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Quick Actions Section -->
        <h2 class="section-title">
            <div class="section-icon"><i class="fas fa-bolt"></i></div>
            Quick Actions
        </h2>
        
        <div class="row mb-4">
            {% if request.user.role == 'top_management' or request.user.role == 'business_head' or request.user.role == 'business_head_ops' %}
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'lead_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-bullseye"></i></div>
                        <div class="quick-action-title">Manage Leads</div>
                        <div class="quick-action-desc">View and manage all leads</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'client_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="quick-action-title">Client Portfolio</div>
                        <div class="quick-action-desc">Manage client portfolios</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'team_management' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-sitemap"></i></div>
                        <div class="quick-action-title">Team Management</div>
                        <div class="quick-action-desc">Manage teams and assignments</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'task_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-tasks"></i></div>
                        <div class="quick-action-title">Task Management</div>
                        <div class="quick-action-desc">View and assign tasks</div>
                    </a>
                </div>
            {% elif request.user.role == 'rm_head' %}
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'lead_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-bullseye"></i></div>
                        <div class="quick-action-title">Team Leads</div>
                        <div class="quick-action-desc">Manage team leads</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'client_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="quick-action-title">Team Clients</div>
                        <div class="quick-action-desc">View team client portfolio</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'team_management' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-sitemap"></i></div>
                        <div class="quick-action-title">My Teams</div>
                        <div class="quick-action-desc">Manage your teams</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'task_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-tasks"></i></div>
                        <div class="quick-action-title">Team Tasks</div>
                        <div class="quick-action-desc">Monitor team tasks</div>
                    </a>
                </div>
            {% else %}
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'lead_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-bullseye"></i></div>
                        <div class="quick-action-title">My Leads</div>
                        <div class="quick-action-desc">Manage your leads</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'client_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="quick-action-title">My Clients</div>
                        <div class="quick-action-desc">View your client portfolio</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'task_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-tasks"></i></div>
                        <div class="quick-action-title">My Tasks</div>
                        <div class="quick-action-desc">View and update tasks</div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{% url 'note_list' %}" class="quick-action">
                        <div class="quick-action-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="quick-action-title">Notes</div>
                        <div class="quick-action-desc">Manage your notes</div>
                    </a>
                </div>
            {% endif %}
        </div>

        {% if request.user.role == 'rm' %}
            <!-- Recent Activities for RM -->
            <h2 class="section-title">
                <div class="section-icon"><i class="fas fa-chart-line"></i></div>
                Recent Activities
            </h2>
            
            <div class="activity-list">
                {% for client in recent_clients %}
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">New Client: {{ client.name }}</div>
                            <div class="activity-meta">Added on {{ client.created_at|date:"M d, Y" }}</div>
                        </div>
                    </div>
                {% empty %}
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">No recent activities</div>
                            <div class="activity-meta">Start by adding clients or managing leads</div>
                        </div>
                    </div>
                {% endfor %}

                {% for note in recent_notes %}
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">{{ note.heading|default:"Note updated" }}</div>
                            <div class="activity-meta">Updated {{ note.updated_at|timesince }} ago</div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Performance Chart Placeholder -->
        <div class="chart-section">
            <div class="chart-header">
                <h3 class="chart-title">Performance Analytics</h3>
                <span class="badge bg-primary">Coming Soon</span>
            </div>
            <div class="chart-placeholder">
                <div class="placeholder-icon"><i class="fas fa-chart-bar"></i></div>
                <div class="placeholder-text">Analytics Dashboard</div>
                <div class="placeholder-subtext">
                    Performance charts and detailed analytics will be available here.
                    Track your progress, team performance, and business metrics.
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Real-time clock update
    function updateDateTime() {
        const now = new Date();
        const dateOptions = { day: 'numeric', month: 'short', year: 'numeric' };
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
        
        const dateElement = document.querySelector('.date-text');
        const timeElement = document.querySelector('.time-text');
        
        if (dateElement) {
            dateElement.textContent = now.toLocaleDateString('en-GB', dateOptions);
        }
        if (timeElement) {
            timeElement.textContent = now.toLocaleTimeString('en-GB', timeOptions);
        }
    }

    // Update time immediately and then every second
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // Notification bell click handler
    const notificationBell = document.querySelector('.notification-bell');
    if (notificationBell) {
        notificationBell.addEventListener('click', function() {
            // Add notification dropdown or modal functionality here
            console.log('Notifications clicked');
            // You can add AJAX call to fetch notifications
        });
    }

    // User avatar click handler
    const userAvatar = document.querySelector('.user-avatar');
    if (userAvatar) {
        userAvatar.addEventListener('click', function() {
            // Add user menu dropdown functionality here
            console.log('User avatar clicked');
        });
    }

    // Intersection Observer for scroll animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe elements for scroll animations
    const animateOnScroll = document.querySelectorAll('.kpi-card, .metric-card, .stat-item, .activity-list, .chart-section,.aum-section');
    animateOnScroll.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.6s ease';
        observer.observe(el);
    });

    // Add hover effects for cards
    const cards = document.querySelectorAll('.kpi-card, .metric-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.zIndex = '10';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.zIndex = '1';
        });
    });

    // Add click animation for quick actions
    const quickActions = document.querySelectorAll('.quick-action');
    quickActions.forEach(action => {
        action.addEventListener('click', function(e) {
            // Create ripple effect
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.height, rect.width);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                background: rgba(28, 100, 255, 0.2);
                border-radius: 50%;
                transform: translate(${x}px, ${y}px) scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
                z-index: 1000;
            `;
            
            this.style.position = 'relative';
            this.style.overflow = 'hidden';
            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        });
    });

    // Counter animation for metric values
    function animateCounter(element, target, duration = 2000) {
        const start = 0;
        const increment = target / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            
            if (element.textContent.includes('₹')) {
                element.textContent = '₹' + Math.floor(current).toLocaleString('en-IN');
            } else {
                element.textContent = Math.floor(current).toLocaleString('en-IN');
            }
        }, 16);
    }

    // Apply counter animation to values
    setTimeout(() => {
        const valueElements = document.querySelectorAll('.kpi-value, .metric-value, .stat-value');
        valueElements.forEach(element => {
            let targetValue = 0;
            const textContent = element.textContent.replace(/[₹,]/g, '');
            targetValue = parseInt(textContent) || 0;
            
            if (targetValue > 0) {
                animateCounter(element, targetValue, 1500);
            }
        });
    }, 500);

    // Auto-refresh functionality
    let refreshInterval;
    
    function startAutoRefresh() {
        refreshInterval = setInterval(() => {
            console.log('Auto-refreshing dashboard metrics...');
            // Add AJAX calls here to refresh specific metrics
        }, 30000); // Refresh every 30 seconds
    }

    function stopAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
        }
    }

    // Start auto-refresh on page load
    startAutoRefresh();

    // Stop auto-refresh when page becomes hidden
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            stopAutoRefresh();
        } else {
            startAutoRefresh();
        }
    });
});

// Add CSS for ripple animation
const style = document.createElement('style');
style.textContent = `
    @keyframes ripple {
        to {
            transform: translate(var(--x), var(--y)) scale(4);
            opacity: 0;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
{% endblock %}
